import { Texture } from 'texture'
import { validateXML } from 'texture-xml-utils'
import JATSArchiving11 from './JATS-Archiving-1-1-MathML3'
import JATSArchiving12 from './JATS-Archiving-1-2-MathML3'

// EXPERIMENTAL: at the moment, we do not necessarily need this
// as a Texture plugin. We only use it for development, to be able to
// validate output generated by Texture against the particular JATS DTDs.
// When this plugin is loaded, any JATS file will be validated during loading.
Texture.registerPlugin({
  name: 'jats-plugin',
  description: 'Provides JATS validators',
  configure (configurator) {
    let articleConfig = configurator.getConfiguration('article')
    // ATTENTION: Texture does not support JATS 1.0, thus I have removed the validator here
    _registerValidator(articleConfig, JATSArchiving11)
    _registerValidator(articleConfig, JATSArchiving12)
  }
})

function _registerValidator (articleConfig, schema) {
  articleConfig.registerSchemaId(schema.publicId)
  let validator = {
    validate (xmlDom) {
      return validateXML(schema, xmlDom)
    }
  }
  articleConfig.addValidator(schema.publicId, validator)
  if (schema.aliases) {
    schema.aliases.forEach(alias => {
      articleConfig.addValidator(alias, validator)
    })
  }
}
